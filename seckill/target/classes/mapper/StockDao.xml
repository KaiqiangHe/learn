<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kaiqiang.learn.seckill.dao.StockDao">

    <sql id="selectField">id, stock_id, use_stock, total_stock, create_time</sql>

    <!--<select id="selectByStockId" resultType="Stock">
        select <include refid="selectField" />
        from stock
        where stock_id = #{stockId}
    </select>-->

    <insert id="initStock">
        insert into stock(stock_id, use_stock, total_stock)
        values (#{stockId}, 0, #{totalStock});
    </insert>

    <update id="addUseStock">
        update stock
        set use_stock = use_stock + #{addCount}
        where
            use_stock + #{addCount} &lt;= total_stock and
            stock_id = #{stockId};
    </update>
</mapper>